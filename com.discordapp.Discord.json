{
    "app-id": "com.discordapp.Discord",
    "base": "org.electronjs.Electron2.BaseApp",
    "base-version": "22.08",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "22.08",
    "sdk": "org.freedesktop.Sdk",
    "command": "discord",
    "separate-locales": false,
    "tags": [
        "proprietary"
    ],
    "finish-args": [
        "--share=ipc",
        "--socket=x11",
        "--socket=pulseaudio",
        "--share=network",
        "--device=all",
        "--talk-name=org.freedesktop.Notifications",
        "--filesystem=xdg-videos:ro",
        "--filesystem=xdg-pictures:ro",
        "--filesystem=xdg-download",
        "--talk-name=org.kde.StatusNotifierWatcher",
        "--talk-name=com.canonical.AppMenu.Registrar",
        "--talk-name=com.canonical.indicator.application",
        "--talk-name=com.canonical.Unity.LauncherEntry",
        "--own-name=org.kde.*",
        "--env=XCURSOR_PATH=/run/host/user-share/icons:/run/host/share/icons"
    ],
    "modules": [
        {
            "name": "twemoji-fonts",
            "buildsystem": "simple",
            "sources": [
                {
                    "type": "file",
                    "path": "emoji-font.conf"
                },
                {
                    "type": "file",
                    "path": "Twemoji.ttf"
                }
            ],
            "build-commands": [
                "mkdir -p /app/share/fonts/",
                "cp Twemoji.ttf /app/share/fonts/",
                "mkdir -p /app/etc/fonts/",
                "cp emoji-font.conf /app/etc/fonts/local.conf",
                "fc-cache -fv"
            ]
        },
        {
            "name": "xprop",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://xorg.freedesktop.org/archive/individual/app/xprop-1.2.6.tar.xz",
                    "sha256": "580b8525b12ecc0144aa16c88b0aafa76d2e799b44c8c6c50f9ce92788b5586e",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 14958,
                        "url-template": "https://xorg.freedesktop.org/archive/individual/app/xprop-$version.tar.xz"
                    }
                }
            ]
        },
        {
            "name": "python-setuptools_scm",
            "buildsystem": "simple",
            "build-commands": [
                "pip3 install --no-deps --no-build-isolation --verbose --prefix=${FLATPAK_DEST} ."
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/57/38/930b1241372a9f266a7df2b184fb9d4f497c2cef2e016b014f82f541fe7c/setuptools_scm-6.0.1.tar.gz",
                    "sha256": "d1925a69cb07e9b29416a275b9fadb009a23c148ace905b2fb220649a6c18e92"
                }
            ]
        },
        {
            "name": "python-xlib",
            "buildsystem": "simple",
            "build-commands": [
                "pip3 install --no-deps --no-build-isolation --verbose --prefix=${FLATPAK_DEST} ."
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/86/f5/8c0653e5bb54e0cbdfe27bf32d41f27bc4e12faa8742778c17f2a71be2c0/python-xlib-0.33.tar.gz",
                    "sha256": "55af7906a2c75ce6cb280a584776080602444f75815a7aff4d287bb2d7018b32",
                    "x-checker-data": {
                        "type": "pypi",
                        "name": "python-xlib"
                    }
                }
            ]
        },
        {
            "name": "discord",
            "buildsystem": "simple",
            "build-commands": [
                "install -Dm755 discord.sh /app/bin/discord",
                "install -Dm755 set-gtk-dark-theme.py /app/bin",
                "install -Dm755 disable-breaking-updates.py /app/bin",
                "mv Discord /app/discord",
                "chmod +x /app/discord/Discord",
                "install -d /app/share/applications",
                "sed -e 's/Icon=discord/Icon=com.discordapp.Discord/' -e 's|Exec=/usr/share/discord/Discord|Exec=discord|' /app/discord/discord.desktop > /app/share/applications/${FLATPAK_ID}.desktop",
                "install -Dm644 /app/discord/discord.png /app/share/icons/hicolor/256x256/apps/${FLATPAK_ID}.png",
                "install -Dm644 com.discordapp.Discord.appdata.xml /app/share/appdata/com.discordapp.Discord.appdata.xml"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://dl.discordapp.net/apps/linux/0.0.27/discord-0.0.27.tar.gz",
                    "sha256": "e9f1da88f05cbfb4d0561f936ad20461767f2f03e69c2994fd059728581447b5",
                    "strip-components": 0,
                    "x-checker-data": {
                        "type": "rotating-url",
                        "url": "https://discord.com/api/download?platform=linux&format=tar.gz",
                        "pattern": "https://dl.discordapp.net/apps/linux/([0-9.]+)/discord-([0-9.]+).tar.gz"
                    }
                },
                {
                    "type": "file",
                    "path": "discord.sh"
                },
                {
                    "type": "file",
                    "path": "com.discordapp.Discord.appdata.xml"
                },
                {
                    "type": "file",
                    "path": "set-gtk-dark-theme.py"
                },
                {
                    "type": "file",
                    "path": "disable-breaking-updates.py"
                }
            ],
            "modules": [
                {
                    "name": "pciutils",
                    "disabled": true,
                    "no-autogen": true,
                    "make-args": [
                        "SHARED=yes",
                        "PREFIX=/app"
                    ],
                    "make-install-args": [
                        "SHARED=yes",
                        "PREFIX=/app"
                    ],
                    "sources": [
                        {
                            "type": "archive",
                            "url": "https://github.com/pciutils/pciutils/archive/v3.9.0.tar.gz",
                            "sha256": "17829b1fc3ef2a022f2b0a6c4d7a686b53a2fb0233951c31f9344e0abc4034bf",
                            "x-checker-data": {
                                "type": "anitya",
                                "project-id": 2605,
                                "url-template": "https://github.com/pciutils/pciutils/archive/v$version.tar.gz"
                            }
                        }
                    ]
                },
                {
                    "name": "socat",
                    "sources": [
                        {
                            "type": "archive",
                            "url": "http://www.dest-unreach.org/socat/download/socat-1.7.4.4.tar.gz",
                            "sha256": "0f8f4b9d5c60b8c53d17b60d79ababc4a0f51b3bb6d2bd3ae8a6a4b9d68f195e",
                            "x-checker-data": {
                                "type": "anitya",
                                "project-id": 4848,
                                "url-template": "http://www.dest-unreach.org/socat/download/socat-$version.tar.gz"
                            }
                        }
                    ]
                }
            ]
        }
    ]
}
